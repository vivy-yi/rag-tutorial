# æ¨¡å—1ç»ƒä¹ é¢˜å‚è€ƒç­”æ¡ˆ

> æœ¬æ–‡æ¡£æä¾›æ¨¡å—1æ‰€æœ‰ç»ƒä¹ é¢˜çš„è¯¦ç»†ç­”æ¡ˆå’Œè§£æ

---

## ç¬¬1ç« ï¼šRAGæŠ€æœ¯æ¦‚è¿°

### ç»ƒä¹ 1.1ï¼šæ¦‚å¿µç†è§£

**é¢˜ç›®**ï¼šåˆ¤æ–­ä»¥ä¸‹è¯´æ³•æ˜¯å¦æ­£ç¡®ï¼Œå¹¶è¯´æ˜ç†ç”±

1. RAGå¯ä»¥å®Œå…¨è§£å†³LLMçš„å¹»è§‰é—®é¢˜
2. RAGç³»ç»Ÿå¿…é¡»ä½¿ç”¨å‘é‡æ•°æ®åº“
3. Fine-tuningå¯ä»¥æ›¿ä»£RAG
4. RAGæ›´é€‚åˆçŸ¥è¯†é¢‘ç¹æ›´æ–°çš„åœºæ™¯

**ç­”æ¡ˆ**ï¼š

1. **âŒ é”™è¯¯**
   - **ç†ç”±**ï¼šRAGå¯ä»¥æ˜¾è‘—å‡å°‘ä½†ä¸èƒ½å®Œå…¨è§£å†³å¹»è§‰é—®é¢˜
   - å¹»è§‰çš„æ¥æºè¿˜åŒ…æ‹¬è®­ç»ƒæ•°æ®ã€ç”Ÿæˆç­–ç•¥ç­‰
   - RAGé€šè¿‡æä¾›çœŸå®ä¸Šä¸‹æ–‡æ¥å‡å°‘å¹»è§‰ï¼Œä½†ä¸èƒ½100%æ¶ˆé™¤

2. **âŒ é”™è¯¯**
   - **ç†ç”±**ï¼šå‘é‡æ•°æ®åº“æ˜¯æœ€å¸¸è§ä½†ä¸æ˜¯å”¯ä¸€é€‰æ‹©
   - è¿˜å¯ä»¥ä½¿ç”¨ï¼šå…³é”®è¯æ£€ç´¢ï¼ˆBM25ï¼‰ã€å…¨æ–‡æ£€ç´¢ã€å›¾æ•°æ®åº“ç­‰
   - RAGçš„æ ¸å¿ƒæ˜¯"æ£€ç´¢+ç”Ÿæˆ"ï¼Œå…·ä½“æ£€ç´¢æŠ€æœ¯å¯ä»¥çµæ´»é€‰æ‹©

3. **âŒ é”™è¯¯**
   - **ç†ç”±**ï¼šä¸¤è€…å„æœ‰ä¼˜åŠ¿ï¼Œä¸åº”æ˜¯æ›¿ä»£å…³ç³»
   - RAGï¼šå¤„ç†å¤–éƒ¨çŸ¥è¯†ã€å®æ—¶æ›´æ–°
   - Fine-tuningï¼šå­¦ä¹ ç‰¹å®šé£æ ¼ã€æ ¼å¼ã€é¢†åŸŸçŸ¥è¯†
   - **æœ€ä½³å®è·µ**ï¼šç»“åˆä½¿ç”¨ï¼ŒRAGæä¾›äº‹å®ï¼ŒFine-tuningæä¾›é£æ ¼

4. **âœ… æ­£ç¡®**
   - **ç†ç”±**ï¼šRAGçš„çŸ¥è¯†æ˜¯å¤–éƒ¨å­˜å‚¨çš„ï¼Œæ›´æ–°æ—¶æ— éœ€é‡æ–°è®­ç»ƒ
   - Fine-tuningéœ€è¦é‡æ–°è®­ç»ƒæ‰èƒ½æ›´æ–°çŸ¥è¯†ï¼Œæˆæœ¬é«˜
   - é€‚åˆçŸ¥è¯†é¢‘ç¹å˜åŒ–çš„åœºæ™¯ï¼šæ–°é—»ã€æ–‡æ¡£ã€æ”¿ç­–ç­‰

---

### ç»ƒä¹ 1.2ï¼šç»„ä»¶åŒ¹é…

**é¢˜ç›®**ï¼šå°†ä»¥ä¸‹åŠŸèƒ½ä¸å¯¹åº”çš„ç»„ä»¶åŒ¹é…

| åŠŸèƒ½ | ç»„ä»¶ |
|------|------|
| 1. ä»PDFæ–‡ä»¶ä¸­æå–æ–‡æœ¬ | æ–‡æ¡£åŠ è½½å™¨ |
| 2. å°†"äººå·¥æ™ºèƒ½å¾ˆå¼ºå¤§"è½¬æ¢ä¸ºå‘é‡ | åµŒå…¥æ¨¡å‹ |
| 3. åœ¨100ä¸‡ä¸ªå‘é‡ä¸­å¿«é€Ÿæœç´¢ | å‘é‡æ•°æ®åº“ |
| 4. å°†é•¿æ–‡æ¡£åˆ‡æˆ500å­—çš„å— | æ–‡æœ¬åˆ†å—å™¨ |
| 5. åŸºäºæ£€ç´¢æ–‡æ¡£ç”Ÿæˆæµç•…ç­”æ¡ˆ | å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ |

**ç­”æ¡ˆ**ï¼š

1. â†’ **æ–‡æ¡£åŠ è½½å™¨** (Document Loaders)
   - ä½œç”¨ï¼šä»PDFã€Wordã€ç½‘é¡µç­‰æ ¼å¼æå–æ–‡æœ¬

2. â†’ **åµŒå…¥æ¨¡å‹** (Embedding Models)
   - ä½œç”¨ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å€¼å‘é‡è¡¨ç¤º

3. â†’ **å‘é‡æ•°æ®åº“** (Vector Stores)
   - ä½œç”¨ï¼šé«˜æ•ˆå­˜å‚¨å’Œæ£€ç´¢å¤§è§„æ¨¡å‘é‡

4. â†’ **æ–‡æœ¬åˆ†å—å™¨** (Text Splitters)
   - ä½œç”¨ï¼šå°†é•¿æ–‡æ¡£åˆ‡åˆ†æˆé€‚åˆå¤„ç†çš„å—

5. â†’ **å¤§è¯­è¨€æ¨¡å‹** (LLMs)
   - ä½œç”¨ï¼šåŸºäºæ£€ç´¢åˆ°çš„æ–‡æ¡£ç”Ÿæˆè‡ªç„¶è¯­è¨€ç­”æ¡ˆ

---

### ç»ƒä¹ 1.3ï¼šåœºæ™¯åˆ†æ

**é¢˜ç›®**ï¼šä»¥ä¸‹åœºæ™¯åº”è¯¥ä½¿ç”¨RAGã€Fine-tuningè¿˜æ˜¯Prompt Engineeringï¼Ÿ

1. è®©AIä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¾“å‡º
2. å›ç­”å…¬å¸2024å¹´çš„é”€å”®æ•°æ®
3. æå‡AIçš„ä»£ç ç”Ÿæˆèƒ½åŠ›
4. å›ç­”ç”¨æˆ·å…³äºäº§å“æ‰‹å†Œçš„é—®é¢˜
5. è®©AIç”¨ä¸“ä¸šçš„æ³•å¾‹æ–‡ä¹¦é£æ ¼å†™ä½œ

**ç­”æ¡ˆ**ï¼š

1. **Prompt Engineering**
   - **åŸå› **ï¼šæ ¼å¼è¦æ±‚ï¼Œä¸éœ€è¦å¤–éƒ¨çŸ¥è¯†
   - æä¾›æ¸…æ™°çš„æ ¼å¼è¯´æ˜å’Œç¤ºä¾‹å³å¯

2. **RAG**
   - **åŸå› **ï¼šéœ€è¦å‡†ç¡®çš„å…¬å¸å†…éƒ¨æ•°æ®
   - çŸ¥è¯†ä¸å…¬å¼€ï¼ŒLLMæ— æ³•ä»è®­ç»ƒæ•°æ®ä¸­è·å¾—
   - RAGå¯ä»¥ä»å†…éƒ¨æ–‡æ¡£æ£€ç´¢å‡†ç¡®ä¿¡æ¯

3. **Fine-tuning**
   - **åŸå› **ï¼šæå‡é€šç”¨ä»£ç ç”Ÿæˆèƒ½åŠ›
   - éœ€è¦å­¦ä¹ ä»£ç æ¨¡å¼ã€æœ€ä½³å®è·µ
   - RAGå¯ä»¥æä¾›å‚è€ƒï¼Œä½†Fine-tuningæå‡åŸºç¡€èƒ½åŠ›

4. **RAG**
   - **åŸå› **ï¼šåŸºäºå…·ä½“äº§å“æ–‡æ¡£å›ç­”
   - ç¡®ä¿ç­”æ¡ˆå‡†ç¡®ï¼Œé¿å…å¹»è§‰
   - å¯ä»¥å¼•ç”¨æ–‡æ¡£æ¥æº

5. **Fine-tuning**
   - **åŸå› **ï¼šå­¦ä¹ ç‰¹å®šçš„å†™ä½œé£æ ¼
   - æ³•å¾‹æ–‡ä¹¦æœ‰ç‰¹å®šæ ¼å¼å’Œæªè¾
   - å¯ä»¥ä½¿ç”¨æ³•å¾‹æ–‡æ¡£æ•°æ®é›†è¿›è¡Œå¾®è°ƒ

**æ€»ç»“**ï¼š
- **Prompt Engineering**ï¼šæ ¼å¼ã€è¡Œä¸ºå¼•å¯¼
- **RAG**ï¼šå‡†ç¡®çš„å¤–éƒ¨çŸ¥è¯†
- **Fine-tuning**ï¼šç‰¹å®šé£æ ¼ã€èƒ½åŠ›æå‡

---

## ç¬¬2ç« ï¼šç¯å¢ƒæ­å»ºä¸å·¥å…·å‡†å¤‡

### ç»ƒä¹ 2.1ï¼šç¯å¢ƒé…ç½®

**é¢˜ç›®**ï¼šå®Œæˆä»¥ä¸‹ç¯å¢ƒé…ç½®ä»»åŠ¡

```python
# ä»»åŠ¡1ï¼šæ£€æŸ¥Pythonç‰ˆæœ¬
import sys
# TODO: æ‰“å°Pythonç‰ˆæœ¬ï¼Œæ£€æŸ¥æ˜¯å¦>=3.9

# ä»»åŠ¡2ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
# TODO: å†™å‡ºåˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤

# ä»»åŠ¡3ï¼šå®‰è£…LlamaIndex
# TODO: å†™å‡ºå®‰è£…å‘½ä»¤
```

**ç­”æ¡ˆ**ï¼š

```python
# ä»»åŠ¡1
import sys
print(f"Pythonç‰ˆæœ¬: {sys.version}")
# æ£€æŸ¥
if sys.version_info >= (3, 9):
    print("âœ… ç‰ˆæœ¬ç¬¦åˆè¦æ±‚")
else:
    print("âŒ éœ€è¦å‡çº§åˆ°Python 3.9+")

# ä»»åŠ¡2 - å‘½ä»¤è¡Œï¼š
# Windows:
# python -m venv venv

# macOS/Linux:
# python3 -m venv venv

# ä»»åŠ¡3 - å‘½ä»¤è¡Œï¼š
# pip install llama-index-core
# æˆ–å®‰è£…å®Œæ•´ç‰ˆæœ¬ï¼š
# pip install llama-index
```

---

### ç»ƒä¹ 2.2ï¼šä¾èµ–ç®¡ç†

**é¢˜ç›®**ï¼šåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„requirements.txtæ–‡ä»¶

**ç­”æ¡ˆ**ï¼š

```txt
# æ ¸å¿ƒæ¡†æ¶
llama-index-core==0.10.0
llama-index-readers==0.10.0
llama-index-llms==0.10.0

# å‘é‡æ•°æ®åº“
chromadb==0.4.22
pinecone-client==2.2.4

# åµŒå…¥æ¨¡å‹
sentence-transformers==2.2.2
openai==1.3.0

# Webæ¡†æ¶
fastapi==0.104.1
uvicorn[standard]==0.24.0

# æ•°æ®å¤„ç†
pandas==2.1.4
numpy==1.26.3

# å®ç”¨å·¥å…·
python-dotenv==1.0.0
tqdm==4.66.1
```

---

## ç¬¬3ç« ï¼šåŸºç¡€RAGå®ç°

### ç»ƒä¹ 3.1ï¼šå®ŒæˆRAGæµç¨‹

**é¢˜ç›®**ï¼šå®ç°å®Œæ•´çš„RAG queryå‡½æ•°

```python
def rag_pipeline(query, knowledge_base, llm):
    """
    ç®€å•çš„RAGæµç¨‹
    
    Args:
        query: ç”¨æˆ·é—®é¢˜
        knowledge_base: æ–‡æ¡£åˆ—è¡¨
        llm: è¯­è¨€æ¨¡å‹å‡½æ•°
    
    Returns:
        ç­”æ¡ˆ
    """
    # TODO: å®ç°RAGæµç¨‹
    # 1. æ£€ç´¢ç›¸å…³æ–‡æ¡£
    # 2. æ„å»ºæç¤ºè¯
    # 3. ç”Ÿæˆç­”æ¡ˆ
    
    pass
```

**ç­”æ¡ˆ**ï¼š

```python
def rag_pipeline(query, knowledge_base, llm):
    """
    ç®€å•çš„RAGæµç¨‹
    """
    # 1. æ£€ç´¢ç›¸å…³æ–‡æ¡£
    # ç®€åŒ–å®ç°ï¼šåŸºäºå…³é”®è¯åŒ¹é…
    query_words = set(query.lower().split())
    
    relevant_docs = []
    for doc in knowledge_base:
        doc_words = set(doc.lower().split())
        overlap = len(query_words & doc_words)
        if overlap > 0:
            relevant_docs.append((doc, overlap))
    
    # æŒ‰ç›¸å…³æ€§æ’åº
    relevant_docs.sort(key=lambda x: x[1], reverse=True)
    
    if not relevant_docs:
        return "æŠ±æ­‰ï¼ŒçŸ¥è¯†åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚"
    
    # 2. æ„å»ºæç¤ºè¯
    context = "\n".join([doc for doc, _ in relevant_docs[:3]])
    prompt = f"""åŸºäºä»¥ä¸‹æ–‡æ¡£å›ç­”é—®é¢˜ã€‚å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç­”æ¡ˆï¼Œè¯·è¯´"æ–‡æ¡£ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ä¿¡æ¯"ã€‚

æ–‡æ¡£:
{context}

é—®é¢˜: {query}

ç­”æ¡ˆ:"""
    
    # 3. ç”Ÿæˆ
    answer = llm(prompt)
    
    return answer
```

---

### ç»ƒä¹ 3.2ï¼šä¼˜åŒ–æ£€ç´¢ç­–ç•¥

**é¢˜ç›®**ï¼šæ”¹è¿›ä¸Šè¿°ä»£ç ï¼Œä½¿ç”¨æ›´å¥½çš„æ£€ç´¢ç­–ç•¥

**ç­”æ¡ˆ**ï¼š

```python
def rag_pipeline_improved(query, knowledge_base, llm):
    """
    æ”¹è¿›çš„RAGæµç¨‹
    """
    # 1. ä½¿ç”¨TF-IDFæ£€ç´¢
    from sklearn.feature_extraction.text import TfidfVectorizer
    from sklearn.metrics.pairwise import cosine_similarity
    
    vectorizer = TfidfVectorizer()
    doc_vectors = vectorizer.fit_transform(knowledge_base)
    query_vector = vectorizer.transform([query])
    
    similarities = cosine_similarity(query_vector, doc_vectors)[0]
    
    # è·å–top-3æ–‡æ¡£
    top_indices = similarities.argsort()[-3:][::-1]
    
    retrieved_docs = [knowledge_base[i] for i in top_indices]
    
    # 2. æ„å»ºæ›´å¥½çš„æç¤ºè¯
    context_with_sources = "\n\n".join([
        f"[æ¥æº{i+1}] {doc[:100]}..."
        for i, doc in enumerate(retrieved_docs)
    ])
    
    prompt = f"""è¯·åŸºäºä»¥ä¸‹å‚è€ƒèµ„æ–™å›ç­”é—®é¢˜ã€‚æ³¨æ„ï¼š
1. åªä½¿ç”¨æä¾›çš„å‚è€ƒèµ„æ–™
2. å¦‚æœå‚è€ƒèµ„æ–™ä¸­æ²¡æœ‰ç­”æ¡ˆï¼Œæ˜ç¡®è¯´æ˜
3. åœ¨å›ç­”ä¸­å¼•ç”¨å…·ä½“æ¥æº

å‚è€ƒèµ„æ–™:
{context_with_sources}

é—®é¢˜: {query}

ç­”æ¡ˆ:"""
    
    # 3. ç”Ÿæˆ
    answer = llm(prompt)
    
    return {
        'answer': answer,
        'sources': [f"æ¥æº{i+1}" for i in top_indices]
    }
```

---

## ç¬¬4ç« ï¼šRAGè¯„ä¼°åŸºç¡€

### ç»ƒä¹ 4.1ï¼šå®ç°è¯„ä¼°æŒ‡æ ‡

**é¢˜ç›®**ï¼šå®ç°ä»¥ä¸‹è¯„ä¼°æŒ‡æ ‡

1. **Hit Rate**: å‘½ä¸­ç‡
2. **MRR**: å¹³å‡å€’æ•°æ’å
3. **Precision@K**: å‰Kä¸ªç»“æœçš„ç²¾åº¦

**ç­”æ¡ˆ**ï¼š

```python
import numpy as np

def hit_rate(retrieved_list, relevant_list):
    """
    è®¡ç®—å‘½ä¸­ç‡
    
    Args:
        retrieved_list: æ¯ä¸ªæŸ¥è¯¢çš„æ£€ç´¢ç»“æœåˆ—è¡¨
        relevant_list: æ¯ä¸ªæŸ¥è¯¢çš„ç›¸å…³æ–‡æ¡£åˆ—è¡¨
    
    Returns:
        å‘½ä¸­ç‡ (0-1)
    """
    hits = 0
    total = len(retrieved_list)
    
    for retrieved, relevant in zip(retrieved_list, relevant_list):
        if any(doc in retrieved for doc in relevant):
            hits += 1
    
    return hits / total if total > 0 else 0.0


def mrr(retrieved_list, relevant_list, k=10):
    """
    è®¡ç®—å¹³å‡å€’æ•°æ’å
    
    Args:
        retrieved_list: æ£€ç´¢ç»“æœåˆ—è¡¨
        relevant_list: ç›¸å…³æ–‡æ¡£åˆ—è¡¨
        k: è€ƒè™‘å‰kä¸ªç»“æœ
    
    Returns:
        MRRåˆ†æ•° (0-1)
    """
    reciprocal_ranks = []
    
    for retrieved, relevant in zip(retrieved_list, relevant_list):
        if not relevant:
            continue
        
        # æ‰¾åˆ°ç¬¬ä¸€ä¸ªç›¸å…³æ–‡æ¡£çš„ä½ç½®
        for rank, item in enumerate(retrieved[:k], 1):
            if item in relevant:
                reciprocal_ranks.append(1.0 / rank)
                break
        
        if not reciprocal_ranks:
            reciprocal_ranks.append(0.0)
    
    return np.mean(reciprocal_ranks)


def precision_at_k(retrieved_list, relevant_list, k=3):
    """
    è®¡ç®—Precision@K
    
    Args:
        retrieved_list: æ£€ç´¢ç»“æœåˆ—è¡¨
        relevant_list: ç›¸å…³æ–‡æ¡£åˆ—è¡¨
        k: å‰kä¸ªç»“æœ
    
    Returns:
        Precision@K (0-1)
    """
    precisions = []
    
    for retrieved, relevant in zip(retrieved_list, relevant_list):
        retrieved_at_k = retrieved[:k]
        relevant_count = sum(1 for item in retrieved_at_k if item in relevant)
        precisions.append(relevant_count / k)
    
    return np.mean(precisions) if precisions else 0.0
```

---

### ç»ƒä¹ 4.2ï¼šè¯„ä¼°å‡½æ•°ä½¿ç”¨

**é¢˜ç›®**ï¼šä½¿ç”¨ä¸Šè¿°å‡½æ•°è¯„ä¼°ä»¥ä¸‹åœºæ™¯

```python
# æµ‹è¯•æ•°æ®
queries = [
    "Pythonæ˜¯ä»€ä¹ˆ",
    "æœºå™¨å­¦ä¹ vsæ·±åº¦å­¦ä¹ ",
    "é‡å­è®¡ç®—åŸºç¡€"
]

retrieved_results = [
    ["doc1", "doc2"],      # ç¬¬1ä¸ªæŸ¥è¯¢ç»“æœ
    ["doc3", "doc1", "doc4"],  # ç¬¬2ä¸ªæŸ¥è¯¢ç»“æœ
    []                     # ç¬¬3ä¸ªæŸ¥è¯¢ç»“æœ
]

relevant_results = [
    ["doc1"],           # ç¬¬1ä¸ªæŸ¥è¯¢ç›¸å…³æ–‡æ¡£
    ["doc3"],           # ç¬¬2ä¸ªæŸ¥è¯¢ç›¸å…³æ–‡æ¡£
    []                  # ç¬¬3ä¸ªæŸ¥è¯¢æ— ç›¸å…³æ–‡æ¡£
]
```

**ç­”æ¡ˆ**ï¼š

```python
# è¯„ä¼°

# 1. Hit Rate
hit_rate_value = hit_rate(retrieved_results, relevant_results)
print(f"Hit Rate: {hit_rate_value:.2f}")
# è¾“å‡º: Hit Rate: 0.67
# è§£è¯»: 3ä¸ªæŸ¥è¯¢ä¸­ï¼Œæœ‰2ä¸ªå‘½ä¸­

# 2. MRR
mrr_value = mrr(retrieved_results, relevant_results, k=5)
print(f"MRR: {mrr_value:.3f}")
# è¾“å‡º: MRR: 0.667
# è§£è¯»:
# - æŸ¥è¯¢1: doc1åœ¨ç¬¬1ä½ â†’ 1/1 = 1.0
# - æŸ¥è¯¢2: doc3åœ¨ç¬¬1ä½ â†’ 1/1 = 1.0
# - æŸ¥è¯¢3: æ— ç›¸å…³ â†’ 0
# å¹³å‡: (1.0 + 1.0 + 0) / 3 = 0.667

# 3. Precision@3
p3_value = precision_at_k(retrieved_results, relevant_results, k=3)
print(f"Precision@3: {p3_value:.3f}")
# è¾“å‡º: Precision@3: 0.333
# è§£è¯»:
# - æŸ¥è¯¢1: å‰3ä¸ªä¸­1ä¸ªç›¸å…³ â†’ 1/3 = 0.333
# - æŸ¥è¯¢2: å‰3ä¸ªä¸­1ä¸ªç›¸å…³ â†’ 1/3 = 0.333
# - æŸ¥è¯¢3: å‰3ä¸ªä¸­0ä¸ªç›¸å…³ â†’ 0/3 = 0
# å¹³å‡: (0.333 + 0.333 + 0) / 3 = 0.222
```

---

### ç»ƒä¹ 4.3ï¼šè¯„ä¼°ç»“æœåˆ†æ

**é¢˜ç›®**ï¼šæ ¹æ®è¯„ä¼°ç»“æœï¼Œåˆ†æä»¥ä¸‹RAGç³»ç»Ÿçš„é—®é¢˜

| æŒ‡æ ‡ | å€¼ | ç›®æ ‡ |
|------|-----|------|
| Hit Rate | 0.65 | >0.8 |
| MRR | 0.45 | >0.7 |
| Precision@3 | 0.40 | >0.6 |

**ç­”æ¡ˆ**ï¼š

**é—®é¢˜åˆ†æ**ï¼š

1. **Hit Rate (0.65 < 0.8)**
   - **é—®é¢˜**ï¼š35%çš„æŸ¥è¯¢æ‰¾ä¸åˆ°ç›¸å…³æ–‡æ¡£
   - **å¯èƒ½åŸå› **ï¼š
     - æ–‡æ¡£è¦†ç›–ä¸è¶³
     - åˆ†å—ç­–ç•¥ä¸åˆç†
     - æŸ¥è¯¢ç†è§£é—®é¢˜
   - **æ”¹è¿›å»ºè®®**ï¼š
     - æ‰©å……çŸ¥è¯†åº“å†…å®¹
     - ä¼˜åŒ–åˆ†å—å¤§å°å’Œoverlap
     - æ·»åŠ æŸ¥è¯¢é‡å†™/æ‰©å±•

2. **MRR (0.45 < 0.7)**
   - **é—®é¢˜**ï¼šç›¸å…³æ–‡æ¡£å¹³å‡æ’åé å
   - **å¯èƒ½åŸå› **ï¼š
     - æ£€ç´¢ç®—æ³•ç²¾åº¦ä¸è¶³
     - ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•é€‰æ‹©ä¸å½“
     - æ–‡æ¡£è¡¨ç¤ºä¸å¤Ÿå‡†ç¡®
   - **æ”¹è¿›å»ºè®®**ï¼š
     - å‡çº§åµŒå…¥æ¨¡å‹
     - ä½¿ç”¨æ··åˆæ£€ç´¢ï¼ˆVector + BM25ï¼‰
     - æ·»åŠ é‡æ’åº

3. **Precision@3 (0.40 < 0.6)**
   - **é—®é¢˜**ï¼šå‰3ä¸ªç»“æœä¸­ç›¸å…³æ–‡æ¡£æ¯”ä¾‹ä½
   - **å¯èƒ½åŸå› **ï¼š
     - æ£€ç´¢å¬å›äº†ä¸ç›¸å…³æ–‡æ¡£
     - æ’åºç®—æ³•ä¸å‡†ç¡®
   - **æ”¹è¿›å»ºè®®**ï¼š
     - æé«˜æ£€ç´¢ç²¾åº¦
     - ä½¿ç”¨CrossEncoderé‡æ’åº
     - è°ƒæ•´top_kå€¼

**ä¼˜åŒ–ä¼˜å…ˆçº§**ï¼š
1. **é«˜ä¼˜å…ˆçº§**ï¼šä¼˜åŒ–Hit Rateï¼ˆå¢åŠ æ–‡æ¡£è¦†ç›–ï¼‰
2. **ä¸­ä¼˜å…ˆçº§**ï¼šæå‡MRRï¼ˆæ”¹è¿›æ’åºè´¨é‡ï¼‰
3. **ä¸­ä¼˜å…ˆçº§**ï¼šæé«˜Precision@3ï¼ˆé‡æ’åºï¼‰

---

## ç¬¬5ç« ï¼šæ¨¡å—1æ€»ç»“ä¸é¡¹ç›®

### ç»ƒä¹ 5.1ï¼šç»¼åˆé¡¹ç›®

**é¢˜ç›®**ï¼šå®ç°ä¸€ä¸ªå®Œæ•´çš„RAGç³»ç»Ÿ

**è¦æ±‚**ï¼š
- æ”¯æŒæ–‡æ¡£ä¸Šä¼ å’Œç®¡ç†
- å®ç°æŸ¥è¯¢ç•Œé¢
- æ˜¾ç¤ºç­”æ¡ˆæ¥æº
- åŸºæœ¬çš„è¯„ä¼°åŠŸèƒ½

**ç­”æ¡ˆæ¡†æ¶**ï¼š

```python
# é¡¹ç›®ç»“æ„
rag_project/
â”œâ”€â”€ app.py              # FastAPIåº”ç”¨
â”œâ”€â”€ documents/          # æ–‡æ¡£å­˜å‚¨
â”œâ”€â”€ vector_store.py     # å‘é‡å­˜å‚¨
â”œâ”€â”€ rag.py              # RAGæ ¸å¿ƒé€»è¾‘
â””â”€â”€ evaluation.py       # è¯„ä¼°æ¨¡å—

# app.py - FastAPIåº”ç”¨
from fastapi import FastAPI, UploadFile, HTTPException
from pydantic import BaseModel

app = FastAPI(title="RAGé—®ç­”ç³»ç»Ÿ")

class QueryRequest(BaseModel):
    question: str
    top_k: int = 3

class QueryResponse(BaseModel):
    answer: str
    sources: list[str]

@app.post("/query", response_model=QueryResponse)
async def query_endpoint(request: QueryRequest):
    # è°ƒç”¨RAGç³»ç»Ÿ
    result = rag_query(request.question, request.top_k)
    return result

@app.post("/upload")
async def upload_document(file: UploadFile = File(...)):
    # ä¿å­˜æ–‡æ¡£
    # æ›´æ–°å‘é‡ç´¢å¼•
    return {"status": "success"}

# rag.py - RAGæ ¸å¿ƒé€»è¾‘
def rag_query(question: str, top_k: int = 3):
    # 1. æ£€ç´¢
    results = vector_store.search(question, top_k=top_k)
    
    # 2. ç”Ÿæˆ
    answer = llm_generate(question, results)
    
    # 3. è¿”å›
    return {
        "answer": answer,
        "sources": results
    }

# evaluation.py - è¯„ä¼°æ¨¡å—
def evaluate_rag_system(test_dataset):
    results = []
    
    for test_case in test_dataset:
        # æŸ¥è¯¢
        result = rag_query(test_case['query'])
        
        # è¯„ä¼°
        hit = evaluate_hit(result, test_case)
        relevancy = evaluate_relevancy(result, test_case)
        
        results.append({
            'query': test_case['query'],
            'hit': hit,
            'relevancy': relevancy
        })
    
    return calculate_metrics(results)
```

---

## æ€»ç»“

### å­¦ä¹ æ£€æŸ¥æ¸…å•

å®Œæˆæ¨¡å—1åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] ç†è§£RAGçš„æ ¸å¿ƒä»·å€¼å’Œ5å¤§ç»„ä»¶
- [ ] æ­å»ºå®Œæ•´çš„ç¯å¢ƒ
- [ ] å®ç°åŸºç¡€çš„RAGç³»ç»Ÿ
- [ ] è¯„ä¼°RAGç³»ç»Ÿè´¨é‡
- [ ] è¯†åˆ«å¸¸è§é—®é¢˜å¹¶ä¼˜åŒ–

### ä¸‹ä¸€æ­¥

**æ­å–œå®Œæˆæ¨¡å—1çš„å­¦ä¹ ï¼** ğŸ‰

**å»ºè®®**ï¼š
1. å®Œæˆç¬¬5ç« çš„ç»¼åˆé¡¹ç›®
2. å®è·µæ‰€æœ‰ä»£ç ç¤ºä¾‹
3. å°è¯•ä¼˜åŒ–è‡ªå·±çš„RAGç³»ç»Ÿ

**ç»§ç»­å­¦ä¹ **ï¼š
- æ¨¡å—2ï¼šæ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯
- å®æˆ˜æ¡ˆä¾‹1ï¼šæ™ºèƒ½å®¢æœRAGç³»ç»Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-02-10
**çŠ¶æ€**ï¼šâœ… å®Œæˆ
