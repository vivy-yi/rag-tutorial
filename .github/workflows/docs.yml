name: Deploy Jupyter Notebooks to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install jupyter
          pip install nbconvert
          pip install mkdocs-material
          pip install mkdocs-jupyter

      - name: Convert Notebooks to Markdown
        run: |
          # åˆ›å»ºæ–‡æ¡£ç›®å½•
          mkdir -p site/notebooks

          # è½¬æ¢æ‰€æœ‰notebooks
          for notebook in $(find . -name "*.ipynb" -not -path "./.ipynb_checkpoints/*"); do
            echo "Converting $notebook"
            jupyter nbconvert --to markdown "$notebook" --output-dir site/notebooks/
          done

      - name: Create index page
        run: |
          cat > site/index.md << 'EOF'
          # RAGå®Œæ•´æ•™ç¨‹ - Jupyter Notebooks

          æ¬¢è¿æ¥åˆ°RAGå®Œæ•´æ•™ç¨‹çš„Jupyter Notebookåœ¨çº¿é¢„è§ˆï¼

          ## ğŸ“š Notebookåˆ—è¡¨

          ### æ¨¡å—1ï¼šåŸºç¡€å…¥é—¨

          - [01 - RAGæ ¸å¿ƒæ¦‚å¿µ](notebooks/01_rag_concepts.md)
          - [02 - ç¯å¢ƒæ­å»º](notebooks/02_environment_setup.md)
          - [03 - åŸºç¡€RAGå®ç°](notebooks/03_basic_rag_implementation.md)
          - [04 - RAGè¯„ä¼°](notebooks/04_rag_evaluation.md)

          ### æ¨¡å—2ï¼šæ ¸å¿ƒä¼˜åŒ–

          - [06 - åµŒå…¥æ¨¡å‹æ·±å…¥](notebooks/06_embedding_models.md)
          - [07 - é«˜çº§åˆ†å—ç­–ç•¥](notebooks/07_advanced_chunking.md)
          - [08 - æŸ¥è¯¢å¢å¼ºæŠ€æœ¯](notebooks/08_query_enhancement.md)
          - [09 - æ··åˆæ£€ç´¢](notebooks/09_hybrid_retrieval.md)
          - [10 - é«˜çº§RAGæ¨¡å¼](notebooks/10_advanced_rag_patterns.md)
          - [11 - æ€§èƒ½ä¼˜åŒ–](notebooks/11_performance_optimization.md)
          - [12 - ç»¼åˆä¼˜åŒ–](notebooks/12_comprehensive_optimization.md)
          - [13 - æ£€ç´¢å‹ç¼©](notebooks/13_retrieval_compression.md)

          ### æ¨¡å—3ï¼šé«˜çº§æ¶æ„

          - [13 - ReAct Agent](notebooks/13_react_agent.md)
          - [14 - é«˜çº§Agentæ¨¡å¼](notebooks/14_advanced_agents.md)
          - [14 - Deep Research](notebooks/14_deep_research_agent.md)
          - [15 - GraphRAG](notebooks/15_graph_rag.md)
          - [16 - å¤šæ¨¡æ€RAG](notebooks/16_multimodal_rag.md)

          ---

          **ğŸ’¡ æç¤º**: è¿™äº›æ˜¯Jupyter Notebookè½¬æ¢åçš„Markdownç‰ˆæœ¬ã€‚
          æƒ³è¦äº¤äº’å¼è¿è¡Œï¼Œè¯·å…‹éš†ä»“åº“åˆ°æœ¬åœ°ï¼š
          ```bash
          git clone https://github.com/vivy-yi/rag-tutorial.git
          cd rag-tutorial
          pip install -r requirements.txt
          jupyter notebook
          ```
          EOF

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./site

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
